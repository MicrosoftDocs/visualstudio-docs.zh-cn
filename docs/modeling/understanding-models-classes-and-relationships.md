---
title: 了解模型、类和关系
description: 了解如何通过 DSL 定义 (DSL) 域特定语言，以及 DSL 解决方案中的大多数程序代码都是从此文件生成的。
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- Domain-Specific Language, models
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: b086f21b466863c3498ce15c15f7077b358c6d39
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/19/2021
ms.locfileid: "112388615"
---
# <a name="understanding-models-classes-and-relationships"></a>了解模型、类和关系
DSL (域) 由 DSL 定义文件以及可能编写的任何自定义程序代码定义。 DSL 解决方案中的大多数程序代码都是从此文件生成的。

 本主题介绍 DSL 定义的主要功能。

## <a name="the-dsl-definition"></a>DSL 定义
 打开 时 `Dsl\DslDefinition.dsl` ，Visual Studio窗口如下图所示。

 ![dsl 设计器](../modeling/media/dsl_designer.png)

 DSL 定义中最重要的信息显示在 DSL 定义关系图中。 其他信息（也是 DslDefinition.dsl 的一部分）显示在 DSL 资源管理器中，通常显示在关系图的一侧。 使用关系图处理最常见的任务，使用 DSL 资源管理器进行更高级的自定义。

 DSL 定义关系图显示了用于定义模型元素的域类，以及定义模型元素间链接的关系。 它还显示用于向用户显示模型元素的形状和连接器。

 ![具有泳道的 dsl 设计器](../modeling/media/dsl_desinger.png)

 在 DSL 定义中选择某个项时，无论是关系图上还是 DSL 资源管理器中，有关该项的信息将显示在属性窗口。 其他信息可能会显示在"DSL 详细信息"窗口中。

### <a name="models-are-instances-of-dsls"></a>模型是 DSL 的实例
 *模型* 是由用户创建的 DSL 实例。 模型包含模型元素，这些元素是定义的域类的实例，以及元素之间的链接，这些元素是定义的域关系的实例。 模型还可以具有形状和连接器，这些形状和连接器在关系图上显示模型元素和链接。 DSL 定义包括形状类、连接器类和关系图的类。

 DSL 定义也称为域 *模型*。 DSL 定义或域模型是特定于域的语言的设计时表示形式，而模型是域特定语言的运行时实例化。

## <a name="domain-classes-define-model-elements"></a>域类定义模型元素
 域类用于在域中创建各种元素，域关系是元素之间的链接。 它们是元素和链接的设计时表示形式，这些元素和链接将在用户创建模型时由设计特定语言的用户实例化。

 此图显示了由音乐库 DSL 的用户创建的模型。 音乐集由包含歌曲列表的框表示。 艺术家由圆角框表示，并连接到他们贡献的画集。

 ![生成的 DSL 实例模型](../modeling/media/music_instance.png)

 DSL 定义将两个方面分开。 模型关系图上模型元素的外观是使用形状类和连接器类定义的。 模型中携带的信息是使用域类和域关系定义的。

 下图显示了音乐库的 DSL 定义中的域类和关系。

 ![嵌入关系和引用关系](../modeling/media/music_classes.png)

 此图显示了四个域类：Music、Album、Artist 和 Song。 域类定义域属性，如名称、标题等。 在实例模型中，其中一些属性的值显示在关系图上。

 类之间是域关系：MusicHasAlbums、MusicHasArtists、AlbumbHasSongs 和 ArtistAppearedOnAlbums。 这些关系具有乘数，例如 1..1、0..*。 例如，通过 AlbumHasSongs 关系，每个 Song 必须只与一个 Album 相关。 每个发行集可以有任意数目的歌曲。

### <a name="rearranging-the-dsl-definition-diagram"></a>重新组织 DSL 定义关系图
 请注意，域类可以多次出现在 DSL 定义关系图上，正如本图中所示。 始终有一个主视图，并且可以有一 *些引用* 视图。

 若要重新排列 DSL 定义关系图，可以：

- 使用"将树引入此处"和"拆分树"命令交换 **主视图和引用** 视图。 右键单击单个域类以查看这些命令。

- 按 Ctrl+Up 和 Ctrl+Down 对域类和形状类重新排序。

- 使用每个形状右上角的图标折叠或展开类。

- 通过单击域类底部的减号 (-) 折叠树的各个部分。

## <a name="inheritance"></a>继承
 可以使用继承定义域类。 若要创建继承派生，请单击继承工具，单击派生类，然后单击基类。 模型元素具有在其自己的域类上定义的所有属性，以及从基类继承的所有属性。 它还继承它在关系中的角色。

 还可以在关系、形状和连接器之间使用继承。 继承必须保留在同一组中。 形状不能从域类继承。

## <a name="domain-relationships"></a>域关系
 模型元素可以通过关系进行链接。 链接始终为二进制链接;它们只链接两个元素。 但是，任何元素都可以有许多指向其他对象的链接，并且同一对元素之间甚至可以存在多个链接。

 正如可以定义不同元素类一样，也可以定义不同的链接类。 链接的类称为域 *关系*。 域关系指定其实例可以连接的元素类。 关系的每一端都称为角色 *，域* 关系定义两个角色以及关系本身的名称。

 有两种类型的域关系：嵌入关系和引用关系。 在 DSL 定义关系图中，嵌入关系在每个角色上都有实线，引用关系具有虚线。

### <a name="embedding-relationships"></a>嵌入关系
 模型（根除外）的所有元素都是一个嵌入链接的目标。 因此，整个模型构成了嵌入链接的单个树。 嵌入关系表示包含或所有权。 与此相关的两个模型元素也称为父级和子级。 子级被说为嵌入在父级中。

 嵌入链接通常不会在关系图上显式显示为连接器。 相反，它们通常由包含表示。 模型的根由关系图表示，嵌入在该模型中的元素在关系图上显示为形状。

 在示例中，根类 Music 与 MusicHasAlbums 具有嵌入关系 MusicHasAlbums，该关系将 AlbumHasSongs 嵌入到 Music。 歌曲在每个相集内的列表中显示为项。 音乐还有一个将 MusicHasArtists 嵌入到 Artist 类，其实例也作为形状显示在关系图上。

 默认情况下，删除嵌入元素的父元素时会自动删除这些元素。

 将模型保存到 XML 格式的文件时，嵌入元素将嵌套在它们的父元素中，除非已自定义序列化。

> [!NOTE]
> 嵌入与继承不同。 嵌入关系中的子级不继承父级的属性。 嵌入是模型元素之间的一种链接。 继承是类之间的关系，不会在模型元素之间创建链接。

### <a name="embedding-rules"></a>嵌入规则
 实例模型的每一个元素都必须是一个嵌入链接的目标，模型的根除外。

 因此，除根类外，每个非抽象域类都必须是至少一个嵌入关系的目标，或者必须从基类继承嵌入。 类可以是两个或多个嵌入的目标，但其实例模型元素一次只能有一个父级。 从目标到源的乘数必须为 0..1 或 1..1。

### <a name="the-explorer-displays-the-embedding-tree"></a>资源管理器显示嵌入树
 DSL 定义还会创建一个资源管理器，用户会看到该资源管理器及其模型关系图。

 ![生成的 DSL 资源管理器](../modeling/media/music_explorer.png)

 资源管理器显示模型中的所有元素，甚至显示尚未定义任何形状的元素。 它显示元素和嵌入关系，但不显示引用关系。

 为了查看元素的域属性的值，用户选择一个元素（在模型关系图中或模型资源管理器中）并打开属性窗口。 它显示所有域属性，包括关系图上未显示的属性。 在示例中，每个歌曲都有"标题"和"流派"，但关系图上只显示"标题"的值。

## <a name="reference-relationships"></a>引用关系
 引用关系表示任何未嵌入的关系。

 引用关系通常在关系图上显示为形状之间的连接器。

 在模型的 XML 表示形式中，使用名字对象表示两个元素之间的 *引用链接。* 也就是说，名字对象是唯一标识模型中每个元素的名称。 每个模型元素的 XML 节点都包含一个节点，该节点指定关系的名称和其他元素的名字对象。

## <a name="roles"></a>角色
 每个域关系都有两个角色：源角色和目标角色。

 下图中，发布服务器域类和 **PublisherCatalog** 域关系之间的行是源角色。 域关系与 **Album** 域类之间的行是目标角色。

 ![角色和属性。](../modeling/media/propertycode.png)

 编写遍历模型的程序代码时，与关系关联的名称尤为重要。 例如，生成 DSL 解决方案时，生成的类发布服务器具有属性 Catalog，该属性是一个相集集合。 类 Album 具有属性 Publisher，该属性是类 Publisher 的单个实例。

 在 DSL 定义中创建关系时，为属性和关系名称提供默认值。 但是，可以更改它们。

## <a name="multiplicities"></a>乘数
 乘数指定在域关系中可以具有相同角色的元素数。 在示例中，从零到多 (0。。 \*) 目录角色的多重性设置指定发布服务器域类的任何实例可以具有你想要提供多少个 **PublisherCatalog** 关系链接。

 通过键入关系图或在"属性"窗口中修改 属性来配置 `Multiplicity` 角色 **的多重** 性。 下表描述了此属性的设置。

|多重类型|描述|
|-|-|
|0..* (零到多个) |域类的每个实例可以有多个关系实例，也可以没有关系的实例。|
|0..1 (零到一) |域类的每个实例只能有一个关系实例或关系实例。|
|1..1 (一) |域类的每个实例都可以有一个关系实例。 不能从角色类的任何实例创建此关系的多个实例。 如果启用了验证，则当角色类的任何实例没有关系实例时，将显示验证错误。|
|1..* (一对多) |具有此多重性的角色上的 类的每个实例可以具有关系的多个实例，并且每个实例必须至少有一个关系实例。 如果启用了验证，则当角色类的任何实例没有关系实例时，将显示验证错误。|

## <a name="domain-relationships-as-classes"></a>作为类的域关系
 链接在 Store 中表示为 LinkElement 的实例，该实例是 ModelElement 的派生类。 可以在域关系的域模型关系图中定义这些属性。

 还可以使关系成为其他关系的源或目标。 在域模型关系图中，右键单击域关系，然后单击"**显示为类"。** 将出现其他类框。 然后，可以将关系连接到它。

 可以部分通过继承来定义关系，就像使用域类一样。 选择派生关系，并设置 **"基** 关系"属性窗口。

 派生关系专门化其基关系。 它链接的域类应派生自 或与基关系链接的类相同。 在模型中创建派生关系的链接时，它是派生关系和基关系的实例。 在程序代码中，可以使用基类或派生类生成的属性导航到链接的相反一端。

## <a name="see-also"></a>另请参阅

- [域特定语言工具术语表](/previous-versions/bb126564(v=vs.100))
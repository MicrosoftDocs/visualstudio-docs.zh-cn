---
title: 调试 T4 文本模板
description: 若要调试设计时文本模板，请保存文本模板文件，然后在解决方案资源管理器中该文件的快捷菜单上选择 "调试 T4 模板"。
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, troubleshooting
- text templates, debugging
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 6c9e4454071002e3bce8478bc825ecfddc17620f
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/19/2021
ms.locfileid: "112385768"
---
# <a name="debugging-a-t4-text-template"></a>调试 T4 文本模板
您可以在文本模板中设置断点。 若要调试设计时文本模板，请保存文本模板文件，然后在解决方案资源管理器中该文件的快捷菜单上选择 " **调试 T4 模板** "。 若要调试运行时文本模板，只需调试其所属的应用程序即可。

 若要调试文本模板，你应该了解模板转换过程的步骤。 不同类型的错误可能发生在每个步骤中。 步骤如下所示。

|步骤|设计时模板：发生时间|运行时模板：发生时间|
|-|-|-|
|代码是从文本模板生成的。<br /><br /> 指令中的错误、不匹配的标记或 disordered 的 `<#...#>` 标记。|保存模板或调用文本转换时。|保存模板或调用文本转换时。|
|编译生成的代码。<br /><br /> 模板代码中的编译错误。|紧跟在上一步之后。|以及你的应用程序代码。|
|代码运行。<br /><br /> 模板代码中的运行时错误。|紧跟在上一步之后。|当应用程序运行并调用模板代码时。|

 在大多数情况下，错误报告中提供了模板代码中的行号。 当错误报告引用临时文件名时，通常的原因是文本模板的代码中的括号不匹配。

 您可以在文本模板中设置断点，并以常规方式进行调试。

## <a name="common-errors-and-fixes"></a>常见错误和修复
 下表列出了最常见的错误及其解决办法。

|错误消息|说明|解决方案|
|-|-|-|
|未能加载 {0} 转换类所继承的基类 ""。|如果在模板指令的参数中找不到指定的基类，则会发生此错误 `inherits` 。 消息提供模板指令的行号。|请确保指定的类存在，并且该程序集所在的程序集在程序集指令中指定。|
|未能解析文件的包含文本：{0}|当找不到包含的模板时发生。 消息提供所请求的包含文件的名称。|请确保文件路径是相对于原始模板路径的路径，或者该文件所在的位置已向主机注册，或者该文件有完整路径。|
|初始化转换对象时生成了错误。 转换将不会运行。|当转换类的 "Initialize () " 失败或返回 false 时发生。|Initialize () 函数中的代码来自在 \<#@template#> 指令和指令处理器中指定的基本转换类。 导致初始化失败的错误可能出现在 "错误列表" 中。 调查失败的原因。 可以通过遵循调试模板的过程来查看用于初始化 () 的实际生成代码。|
|{0}未向指令处理器 "" 的程序集 "" {1} 授予 FullTrust 权限集。 只允许受信任的程序集提供指令处理器。 将不加载此指令处理器。|当系统未向包含指令处理器的程序集授予 FullTrust 权限时发生。 消息提供程序集的名称和指令处理器的名称。|请确保只使用本地计算机上受信任的程序集。|
|路径 " {0} " 必须是此计算机或部分受信任区域的本地路径。|当指令或程序集指令引用不在本地计算机上或网络的受信任区域中的文件时发生。|请确保指令或程序集指令所在的目录位于受信任的区域中。 可以通过 Internet Explorer 将网络目录添加到受信任的区域。|
|多个语法错误，如 "无效的标记" catch "" 或 "命名空间不能直接包含成员"|模板代码中右大括号太多。 编译器会将其与标准生成代码混淆。|检查代码分隔符内的右大括号和方括号的数目。|
|循环或条件未正确编译或执行。 例如：`<#if (i>10)#> Number is: <#= i #>`。<br /><br /> 此代码始终输出 i 的值。 只有 "Number is：" 是有条件的。|在 c # 中，始终使用大括号来包围嵌入到控件语句中的文本块。|添加大括号： `<#if (i>10) { #>    Number is: <#= i #><# } #>` 。|
|处理设计时模板或编译运行时 (预处理) 模板时，"表达式太复杂"。<br /><br /> 尝试检查运行时模板生成的代码时，Visual Studio 将停止工作。|文本块太长。 T4 将文本块转换为字符串连接表达式，并为每个模板行使用一个字符串文本。 非常长的文本块可以 overstep 编译器的大小限制。|使用表达式块（例如）分解长文本块：<br /><br /> `<#= "" #>`|

## <a name="warning-descriptions-and-fixes"></a>警告说明和修复
 下表列出了最常见的警告以及修补程序（如果有）。

|警告消息|说明|解决方案|
|-|-|-|
|加载包含文件 " {0} " 返回了 null 或空字符串。|当包含的文本模板文件为空时发生。 消息提供包含的文件的文件名。|请删除 include 指令，或确保该文件包含某些内容。|
|编译转换：|在编译转换时，将此字符串预置到源自编译器的所有错误或警告。 此字符串表示编译器引发错误或警告。|如果在查找 DLL 时遇到问题，可能需要提供完整路径或完全限定强名称（如果该 DLL 在 GAC 中）。|
|{0}指令中已存在参数 ""。 将忽略重复的参数。|在指令中多次指定参数时发生。 消息提供参数的名称和指令的行号。|请删除重复的参数规范。|
|加载包含文件 "" 时出错 {0} 。 将忽略 include 指令。|当找不到指令中指定的文件时发生 `include` 。 消息提供文件的名称和指令的行号。|请确保包含文件存在于原始文本模板文件所在的目录中或已注册到主机的其中一个包含目录中。|
|为转换类指定的基类无效。 基类必须派生自 VisualStudio. TextTemplating. TextTransformation。|当 `inherits` 模板指令中的参数指定的类不继承自时出现 `TextTransformation` 。 消息提供模板指令的行号。|指定派生自 的类 `TextTransformation` 。|
|在"template"指令中指定了无效区域性。 区域性必须采用"xx-XX"格式。 将使用固定区域性。|在错误指定模板指令中的 culture 参数时发生。 该消息提供模板指令的行号。|将 culture 参数更改为"xx-XX"格式的有效区域性。|
|在模板指令中 {0} 指定了无效的调试值''。 调试值必须是"true"或"false"。 使用默认值"false"。|在模板 `debug` 指令中的 参数指定不正确时发生。 该消息提供模板指令的行号。|将调试参数设置为"true"或"false"。|
|在模板指令中指定了无效的 HostSpecific 值 {0} ''。 HostSpecific 值必须是"true"或"false"。 使用默认值"false"。|在指令中主机特定参数 `template` 的指定不正确时发生。 该消息提供模板指令的行号。|将特定于主机的参数设置为"true"或"false"。|
|在 {0} "template"指令中指定了无效的语言""。 语言必须是"C#"或"VB"。 将使用默认值"C#"。|在 指令中指定不支持的语言时 `template` 发生。 在不区分大小写的情况下，只允许 (C#"或"VB) 。 该消息提供模板指令的行号。|将 `language` 模板指令中的 参数设置为"C#"或"VB"。|
|在模板中找到了多个输出指令。 将忽略第一个项外的所有项。|在模板 `output` 文件中指定多个指令时发生。 该消息提供重复输出指令的行号。|删除重复 `output` 指令。|
|在模板中找到了多个模板指令。 将忽略第一个项外的所有项。 应在一个模板指令中指定模板指令的多个参数。|如果在文本模板文件中指定多个指令， (`template` 包括包含的文件) 。 该消息提供重复模板指令的行号。|将不同的指令 `template` 聚合为一个 `template` 指令。|
|没有为名为''的指令指定 {0} 处理器。 将忽略 指令。|如果指定 指令， `custom` 但不提供 属性，则 `processor` 发生。 该消息提供 指令的名称和行号。|提供 `processor` 一个 属性，该 `directive` 特性包含 指令的处理器名称。|
|找不到名为""的指令的名为""的 {0} {1} 处理器。 将忽略 指令。|当系统找不到在 指令中 `directive` 指定的处理器时 `custom` 发生。 该消息提供指令名称、处理器名称和指令的行号。|将 `processor` 指令中的 属性设置为指令处理器的名称。|
|找不到指令 {0} ""的必需 {1} 参数""。 将忽略 指令。|当系统未提供所需的指令参数时发生。 该消息提供缺失参数的名称、指令名称和行号。|提供缺少的参数。|
|名为"" {0} 的处理器不支持名为""的 {1} 指令。 将忽略 指令。|当指令处理器不支持 指令时发生。 该消息提供有问题的指令的名称和行号以及指令处理器的名称。|更正 指令的名称。|
|文件 ' ' 的 include {0} 指令会导致无限循环。|如果指定了循环 include 指令， (例如，文件 A 包含文件 B，其中包括文件 A) 。|不要指定循环 include 指令。|
|运行转换：|在运行转换时生成的所有错误或警告前，将此字符串预置。|不适用。|
|在 块中发现意外的开始标记或结束标记。 请确保未错误键入开始标记或结束标记，并且模板中没有任何嵌套块。|出现意外的 时显示 \<# or #> 。 也就是说，如果之前没有未打开的打开标记，则 \<# after another open tag that has not been closed, or you have a #> 具有 。 该消息提供不匹配标记的行号。|删除不匹配的开始标记或结束标记，或使用转义字符。|
|指定了错误格式的 指令。 将忽略 指令。 请以 格式指定 指令 `<#@ name [parametername="parametervalue"]*  #>`|如果未以正确的格式指定 指令，则由分析器显示。 该消息提供错误指令的行号。|确保所有指令都为 格式 `<#@ name [parametername="parametervalue"]*  #>` 。 有关详细信息，请参阅 [T4 文本模板指令](../modeling/t4-text-template-directives.md)。|
|无法加载已注册指令处理器 '' 的程序集 {0} ' {1} '<br /><br /> {2}|当宿主无法加载指令处理器时发生。 该消息标识为指令处理器提供的程序集和指令处理器的名称。|请确保指令处理器已正确注册，并且程序集存在。|
|找不到已注册指令 {0} 处理器 '' 的程序集 ' {1} ' 中的类型 ' {2} '<br /><br /> {3}|在无法从指令处理器类型程序集加载指令处理器类型时发生。 该消息提供类型、程序集和指令处理器的名称。|vshost 查找指令处理器 (名称、程序集和类型) 注册表中的名称、程序集和类型。 请确保指令处理器已正确注册，并且该类型存在于程序集中。|
|加载程序集""时 {0} 出现问题|在加载程序集时出现问题时发生。 该消息提供程序集的名称。|可以指定要加载到 指令和 指令处理器 \<@#assembly#> 中的程序集。 此字符串后跟的错误消息应提供更多有关程序集加载失败原因的数据。|
|为名为""的指令创建和初始化处理器时 {1} 出现问题。 处理器的类型为 {0} 。 将忽略 指令。|在系统无法创建或初始化指令处理器时发生。 该消息提供 指令的名称和行号以及处理器的类型。|请确保使用正确的指令处理器，并且指令处理器具有公共默认构造函数。 否则，请使用调试选项找出指令处理器 () 初始化方法失败的原因。 有关详细信息，请参阅 [文本模板疑难解答](../modeling/debugging-a-t4-text-template.md)。|
|处理名为''的指令时引发 {0} 异常。|当指令处理器在处理 指令时引发异常时发生。|请确保指令处理器的参数正确无误。|
|主机在尝试解析程序集引用""时引发了 {0} 异常。|当主机尝试解析程序集引用时引发异常时发生。 该消息提供程序集引用字符串。|程序集引用来自 \<@#assembly#> 指令和 指令处理器。 请确保程序集参数中提供的"name"参数正确无误。|
|尝试为 指令指定不 {1} 受支持的 {0} 值'' {2}|当提供不受支持的要求或提供参数时，由 RequiresProvidesDirectiveProcessor (生成的所有指令处理器派生自) 。|请确保 中提供的 name='value' 对中的名称需要 并提供参数是正确的。|
